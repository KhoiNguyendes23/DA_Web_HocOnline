@{
    Layout = "~/Views/Shared/_LayoutLecturer.cshtml";

}
@{
    ViewBag.Title = "Giáo Viên - Quản Lý Bài Giảng";
}
<h2 class="text-center mb-4 text-primary">🎓 Bảng điều khiển Giáo viên</h2>

<div class="container">
    <div class="d-flex justify-content-between mb-3">
        <div class="d-flex">
            <input type="text" id="searchTitle" class="form-control me-2" placeholder="🔍 Tìm bài giảng theo tiêu đề..." />
            <button id="searchBtn" class="btn btn-primary"><i class="fas fa-search"></i> Tìm kiếm</button>
        </div>
        <button class="btn btn-success" data-bs-toggle="modal" data-bs-target="#addLectureModal"><i class="fas fa-plus"></i> Thêm bài giảng</button>
    </div>

    <table id="lectureTable" class="table table-striped table-hover table-bordered">
        <thead class="table-primary">
            <tr>
                <th>#</th>
                <th>Tiêu đề</th>
                <th>Mô tả</th>
                <th>Ngày tạo</th>
                <th>Thao tác</th>
            </tr>
        </thead>
        <tbody>
            @if (Model != null && Model.Any())
            {
                int count = 1;
                foreach (var lecture in Model)
                {
                    <tr>
                        <td>@count</td>
                        <td>@lecture.Title</td>
                        <td>@lecture.Description</td>
                        <td>@lecture.CreatedDate.ToString("dd/MM/yyyy")</td>
                        <td>
                            <button class="btn btn-warning btn-sm" onclick="editLecture(@lecture.Id)"><i class="fas fa-edit"></i> Sửa</button>
                            <button class="btn btn-danger btn-sm" onclick="deleteLecture(@lecture.Id)"><i class="fas fa-trash-alt"></i> Xóa</button>
                        </td>
                    </tr>
                    count++;
                }
            }
            else
            {
                <tr><td colspan="5" class="text-center">Không có bài giảng nào.</td></tr>
            }
        </tbody>
    </table>
</div>

<!-- Modal Thêm bài giảng -->
<div class="modal fade" id="addLectureModal" tabindex="-1" aria-labelledby="addLectureLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="addLectureLabel">Thêm bài giảng mới</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="lectureForm">
                    <div class="mb-3">
                        <label class="form-label">Tiêu đề</label>
                        <input type="text" class="form-control" id="lectureTitle" required />
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Mô tả</label>
                        <textarea class="form-control" id="lectureDescription" rows="3" required></textarea>
                    </div>
                    <button type="button" class="btn btn-primary" onclick="saveLecture()">Lưu bài giảng</button>
                </form>
            </div>
        </div>
    </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/js/all.min.js"></script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.datatables.net/1.13.4/js/jquery.dataTables.min.js"></script>

<script>
    $(document).ready(function () {
        $('#lectureTable').DataTable({
            "paging": true,
            "searching": true,
            "ordering": true,
            "info": true,
            "lengthMenu": [5, 10, 20],
            "language": {
                "search": "Tìm kiếm:",
                "lengthMenu": "Hiển thị _MENU_ bài giảng",
                "info": "Hiển thị _START_ đến _END_ của _TOTAL_ bài giảng",
                "infoEmpty": "Không có dữ liệu",
                "paginate": {
                    "first": "Đầu",
                    "last": "Cuối",
                    "next": "Tiếp",
                    "previous": "Trước"
                }
            }
        });

        // Tìm kiếm bài giảng
        $('#searchBtn').click(function () {
            let title = $('#searchTitle').val().trim();
            if (title !== "") {
                window.location.href = `/Lecturer/Index?search=${title}`;
            }
        });
    });

    function saveLecture() {
        let title = $('#lectureTitle').val().trim();
        let description = $('#lectureDescription').val().trim();

        if (title === "" || description === "") {
            alert("Vui lòng điền đầy đủ thông tin!");
            return;
        }

        $.ajax({
            url: '/Lecturer/AddLecture',
            type: 'POST',
            contentType: 'application/json',
            data: JSON.stringify({ Title: title, Description: description }),
            success: function () {
                alert("Bài giảng đã được thêm!");
                location.reload();
            },
            error: function () {
                alert("Có lỗi xảy ra!");
            }
        });
    }

    function editLecture(id) {
        alert("Chức năng sửa bài giảng đang được cập nhật...");
    }

    function deleteLecture(id) {
        if (confirm("Bạn có chắc chắn muốn xóa bài giảng này không?")) {
            $.ajax({
                url: `/Lecturer/DeleteLecture/${id}`,
                type: 'POST',
                success: function () {
                    alert("Bài giảng đã được xóa!");
                    location.reload();
                },
                error: function () {
                    alert("Có lỗi xảy ra!");
                }
            });
        }
    }
</script>
