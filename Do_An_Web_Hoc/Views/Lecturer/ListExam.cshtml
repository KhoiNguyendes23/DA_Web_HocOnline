@model IEnumerable<Do_An_Web_Hoc.Models.Exams>

@{
    Layout = "~/Views/Shared/_LayoutLecturer.cshtml";
    ViewData["Title"] = "Danh sách bài kiểm tra";
}

<link rel="stylesheet" href="~/css/exams.css" />

<div class="container mt-4">
    <h2 class="text-primary text-center mb-4">Danh sách bài kiểm tra</h2>
    @if (TempData["SuccessMessage"] != null)
    {
        <div class="alert alert-success">@TempData["SuccessMessage"]</div>
    }

    <!-- Tìm kiếm & Lọc -->
    <form class="row mb-4" method="get" asp-action="ListExam">
        <div class="col-md-4">
            <input type="text" name="searchTerm" value="@ViewBag.SearchTerm" class="form-control" placeholder="Tìm kiếm theo tên bài kiểm tra...">
        </div>
        <div class="col-md-3">
            <select name="statusFilter" class="form-select">
                <option value="">-- Tất cả trạng thái --</option>
                <option value="1" selected="@(ViewBag.StatusFilter == "1")">Đang hoạt động</option>
                <option value="0" selected="@(ViewBag.StatusFilter == "0")">Ngừng hoạt động</option>
            </select>
        </div>
        <div class="col-md-2">
            <button type="submit" class="btn btn-primary w-100">
                <i class="fas fa-filter"></i> Lọc
            </button>
        </div>
    </form>

    <table class="table table-bordered table-striped">
        <thead class="table-primary">
            <tr>
                <th>#</th>
                <th>Tên bài kiểm tra</th>
                <th>Mô tả</th>
                <th>Tổng điểm</th>
                <th>Khóa học</th>
                <th>Ngày tạo</th>
                <th>Trạng thái</th>
                <th>Thao tác</th>
            </tr>
        </thead>
        <tbody>
            @if (Model != null && Model.Any())
            {
                int index = 1;
                foreach (var exam in Model)
                {
                    <tr>
                        <td>@index</td>
                        <td>@exam.ExamName</td>
                        <td>@(string.IsNullOrEmpty(exam.Description) ? "Không có mô tả" : exam.Description)</td>
                        <td>@exam.TotalMarks điểm</td>
                        <td>@exam.CourseID</td>
                        <td>@(exam.CreatedAt?.ToString("dd/MM/yyyy") ?? "Chưa có")</td>

                        <!-- Trạng thái -->
                        <td>
                            <span class="badge bg-@(exam.Status == 1 ? "success" : "danger") exam-status">
                                @(exam.Status == 1 ? "Đang hoạt động" : "Ngừng hoạt động")
                            </span>
                        </td>

                        <!-- Thao tác -->
                        <td>
                            <a href="@Url.Action("ViewExam", "Lecturer", new { id = exam.ExamID })" class="btn btn-sm btn-info">
                                <i class="fas fa-eye"></i>
                            </a>
                            @if (exam.Status == 1)
                            {
                                <a href="@Url.Action("EditExam", "Lecturer", new { id = exam.ExamID })" class="btn btn-sm btn-warning">
                                    <i class="fas fa-edit"></i>
                                </a>
                                <a href="@Url.Action("DeleteExam", "Lecturer", new { id = exam.ExamID })" class="btn btn-sm btn-danger">
                                    <i class="fas fa-trash"></i>
                                </a>
                            }
                            else
                            {
                                <a href="@Url.Action("RestoreExam", "Lecturer", new { id = exam.ExamID })" class="btn btn-sm btn-success">
                                    <i class="fas fa-undo"></i>
                                </a>
                            }
                        </td>
                    </tr>
                    index++;
                }
            }
            else
            {
                <tr>
                    <td colspan="8" class="text-center text-danger">Không có bài kiểm tra nào</td>
                </tr>
            }
        </tbody>
    </table>

    <div class="text-start">
        <a href="@Url.Action("AddExam", "Lecturer")" class="btn btn-success mt-4">
            <i class="fas fa-plus"></i> Thêm bài kiểm tra
        </a>
    </div>
</div>
