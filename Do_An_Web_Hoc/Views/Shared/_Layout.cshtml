@using Microsoft.AspNetCore.Localization
@using Microsoft.AspNetCore.Http
@using Microsoft.AspNetCore.Mvc.Localization
@using Do_An_Web_Hoc.Repositories.Interfaces
@inject IViewLocalizer Localizer
@inject IHttpContextAccessor HttpContextAccessor
@inject ICatogoriesRepository categoriesRepo
@inject ICoursesRepository coursesRepo

<!-- Lấy ngôn ngữ hiện tại từ Cookie -->
@{
    var cultureFeature = HttpContextAccessor.HttpContext?.Features.Get<IRequestCultureFeature>();
    var currentCulture = cultureFeature?.RequestCulture.Culture.Name ?? "vi-VN"; // Mặc định là tiếng Việt
}
@{
    var categories = await categoriesRepo.GetAllCategoriesAsync();
    var courses = await coursesRepo.GetAllCoursesAsync();
}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@ViewData["Title"] - Do_An_Web_Hoc</title>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" rel="stylesheet">

    <!-- Bootstrap trước -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" />

    <!-- CSS của bạn sau để override -->
    <link rel="stylesheet" href="~/css/layout.css" asp-append-version="true" />


</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="nav-container">
            <div class="nav-logo">
                <a asp-controller="Home" asp-action="Index"> <img src="~/images/Home_index_images/GitHub_Logo.png" alt=""></a>
            </div>

            <div class="background"></div>

            <i class="fa-solid fa-bars open-menu"></i>

            <div class="nav-links-container">
                <i class="fa-solid fa-xmark close-menu"></i>

                <ul class="nav-links">
                    <li class="nav-link-item"><a asp-controller="Home" asp-action="Index">@Localizer["Home"]</a></li>
                    <li class="nav-link-item dropdown-menu-branch">
                        <a href="#" data-toggle="dropdown-menu">@Localizer["Courses"]<i class="fa-solid fa-chevron-down"></i></a>
                        <ul class="custom-dropdown-menu">
                            @foreach (var category in categories.Where(c => c.Status == 1))
                            {
                                <li class="dropdown-menu-item has-submenu">
                                    <a href="#">@category.CategoryName <i class="fa-solid fa-angle-right" style="float: right;"></i></a>
                                    <ul class="sub-dropdown-menu">
                                        @foreach (var course in courses.Where(c => c.CategoryID == category.CategoryId && c.Status == 1))
                                        {
                                            <li>
                                                <a asp-controller="Courses" asp-action="Details" asp-route-id="@course.CourseID">
                                                    @course.CourseName
                                                </a>
                                            </li>
                                        }
                                    </ul>
                                </li>
                            }
                        </ul>

                    </li>
                    <li class="nav-link-item"><a asp-controller="AboutMe" asp-action="AboutMe">@Localizer["AboutUs"]</a></li>
                    <li class="nav-link-item"><a asp-controller="Contact" asp-action="Index">@Localizer["Contact"]</a></li>
                    <li class="nav-link-item"><a asp-controller="Account" asp-action="Index">@Localizer["Login"]</a></li>

                    <!-- Dropdown chọn ngôn ngữ -->
                    <li class="nav-link-item custom-lang-container">
                        <div class="custom-lang-wrapper">
                            <form asp-controller="Language" asp-action="SetLanguage" method="post" id="langForm">
                                <div class="custom-lang-select">
                                    <div class="selected-lang" id="langTrigger">
                                        <img src="https://flagcdn.com/w20/@(currentCulture.Split('-')[1].ToLower()).png"
                                             class="lang-flag"
                                             alt="@currentCulture" />
                                        <span>@Localizer[currentCulture.Split('-')[1]]</span>
                                        <i class="fa-solid fa-chevron-down"></i>
                                    </div>
                                    <select name="culture" class="original-select" id="langSelect">
                                        <option value="vi-VN" selected="@(currentCulture == "vi-VN" ? "selected" : null)">@Localizer["Vietnamese"]</option>
                                        <option value="en-US" selected="@(currentCulture == "en-US" ? "selected" : null)">@Localizer["English"]</option>
                                        <option value="fr-FR" selected="@(currentCulture == "fr-FR" ? "selected" : null)">@Localizer["French"]</option>
                                    </select>
                                    <input type="hidden" name="returnUrl" value="@Context.Request.Path" />

                                    <!-- Custom dropdown -->
                                    <div class="custom-lang-dropdown">
                                        <div class="lang-option" data-value="vi-VN">
                                            <img src="https://flagcdn.com/w20/vn.png" class="lang-flag">
                                            <span>@Localizer["Vietnamese"]</span>
                                        </div>
                                        <div class="lang-option" data-value="en-US">
                                            <img src="https://flagcdn.com/w20/us.png" class="lang-flag">
                                            <span>@Localizer["English"]</span>
                                        </div>
                                        <div class="lang-option" data-value="fr-FR">
                                            <img src="https://flagcdn.com/w20/fr.png" class="lang-flag">
                                            <span>@Localizer["French"]</span>
                                        </div>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </li>
                </ul>
            </div>
        </div>     

    </header>

    <!-- Nội dung chính -->
    <div class="content">
        <main role="main" class="pb-3">
            @RenderBody()
        </main>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-md-6">
                    <div class="footer-brand">KTDAH</div>
                    <p class="footer-text">
                        Website học tập trực tuyến với những khóa học chất lượng và tốt nhất.
                    </p>
                    <div class="social-links">
						<a href="#" class="social-link"><i class="fab fa-facebook"></i></a>
                        <a href="#" class="social-link"><i class="fab fa-twitter"></i></a>
                        <a href="#" class="social-link"><i class="fab fa-instagram"></i></a>
                    </div>
                </div>

                <div class="col-md-6 text-md-end">
                    <ul class="footer-links">
                        <li><a asp-controller="Home" asp-action="Index">@Localizer["Home"]</a></li>
                        <li><a asp-controller="AboutMe" asp-action="AboutMe">@Localizer["AboutUs"]</a></li>
                        <li><a asp-controller="Contact" asp-action="Index">@Localizer["Contact"]</a></li>
                    </ul>
                </div>
            </div>

            <div class="copyright text-center">
                © 2025 KTDAH Team. All rights reserved.
            </div>
        </div>
    </footer>

	<script src="~/js/dropdown-menu.js"></script>
	<script src="~/js/language-selector.js"></script>
	<script src="~/js/switch-language.js"></script>

    @await RenderSectionAsync("Scripts", required: false)

</body>
</html>
