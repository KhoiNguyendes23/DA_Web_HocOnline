@{
    Layout = ViewData["Layout"]?.ToString();
    var userId = ViewBag.CurrentUserId ?? 0;
    Func<int, string> getRoleName = roleId => roleId switch
    {
        1 => "Admin",
        2 => "Giảng viên",
        3 => "Học viên",
        _ => "Không rõ"
    };
}

<h3 class="mb-3">💬 Giao diện Chat Realtime</h3>
<div class="row">
    <!-- Danh sách người dùng bên trái -->
    <div class="col-md-3 border-end user-list-container">
        <h6 class="text-muted mt-2">📋 Người dùng</h6>
        <ul class="list-group" id="user-list">
            @foreach (var user in ViewBag.Users)
            {
                <li class="list-group-item list-group-item-action d-flex align-items-center user-item" data-userid="@user.UserID">
                    <img src="@((user.Image ?? "/images/Avatar_images/default-avatar.png"))" class="rounded-circle me-2" width="36" height="36" />
                    <div>
                        <strong>@user.FullName</strong><br />
                        <small class="text-muted">(@getRoleName(user.RoleID))</small>
                    </div>
                </li>
            }
        </ul>
    </div>

    <!-- Khung chat -->
    <div class="col-md-9">
        <h5 id="chat-title" class="mt-2">💬 Chat với <span class="text-primary">...</span></h5>
        <div id="chat-messages" class="chat-box mb-2"></div>

        <div class="input-group">
            <input type="text" id="chat-input" class="form-control" placeholder="Nhập tin nhắn..." />
            <button id="chat-send" class="btn btn-primary">Gửi</button>
        </div>
    </div>
</div>

@section Styles {
    <link rel="stylesheet" href="~/css/chat.css" />
}

@section Scripts {
    <script src="https://cdnjs.cloudflare.com/ajax/libs/microsoft-signalr/7.0.5/signalr.min.js"></script>
    <script src="~/js/chat.js"></script>
    <script>
        const senderId = @userId;
        window.initializeChat(senderId);
    </script>
}
